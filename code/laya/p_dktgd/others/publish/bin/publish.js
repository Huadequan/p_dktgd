!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EFileType=void 0,function(e){e[e.NotExist=0]="NotExist",e[e.Dir=1]="Dir",e[e.File=2]="File"}(t.EFileType||(t.EFileType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static ReplaceAll(e,t,n){for(;e.indexOf(t)>=0;)e=e.replace(t,n);return e}static IsNullOrEmpty(e){return null==e||""==e}}},function(e,t){e.exports=require("process")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LTUtils=void 0;const r=n(1),i=n(0),o=n(6),s=n(7),a=n(2),l=n(3);class c{static CompressJs(e,t){let n=r.statSync(e),s=i.win32.basename(e),a=r.readFileSync(e,{encoding:"utf-8"}),l=o.minify(a);if(l.error)throw console.error("压缩文件",s,"出错",l.error),SyntaxError("文件压缩失败,中断发包");this.WriteStrTo(t,l.code);let c=r.statSync(t),f=n.size/1024,u=c.size/1024,h=u/f,d="("+(100*h).toFixed(2)+"%)";return console.log("压缩",s.green,f.toFixed(2)+"Kb >>>>>>>> "+u.toFixed(2)+"Kb "+(h>1?d.red:d.green)),l.code}static WrapToES5(e){let t=s.execSync("babel ");console.log(t)}static ReplaceAll(e,t,n){let r=e;if(t==n)return r;for(;r.indexOf(t)>=0;)r=r.replace(t,n);return r}static MakeDirExist(e){let t=null;return r.existsSync(e)&&(t=r.statSync(e)),!(!t||!t.isDirectory())||(r.mkdirSync(e,{recursive:!0}),!(!r.existsSync(e)||!r.statSync(e).isDirectory()))}static IsFileOrDir(e){if(!r.existsSync(e))return a.EFileType.NotExist;return r.statSync(e).isFile()?a.EFileType.File:a.EFileType.Dir}static DeleteDir(e){let t=[];if(r.existsSync(e)){t=r.readdirSync(e);for(let n=0;n<t.length;++n){let o=t[n],s=i.join(e,o);r.statSync(s).isDirectory()?this.DeleteDir(s):r.unlinkSync(s)}r.rmdirSync(e)}}static CopyFile(e,t){let n=t.lastIndexOf("\\"),i=t.substring(0,n);c.MakeDirExist(i),r.copyFileSync(e,t)}static CopyDir(e,t,n=null){this.MakeDirExist(t);let o=r.readdirSync(e);for(let s=0;s<o.length;++s){let a=o[s],l=i.join(t,a);if(n&&!n(a,l))continue;let c=i.join(e,a);r.statSync(c).isDirectory()?this.CopyDir(c,l,n):r.copyFileSync(c,l)}}static ReadStrFrom(e){if(!c.IsFileExist(e))return null;return r.statSync(e).isDirectory()?null:r.readFileSync(e,{encoding:"utf-8"})}static IsFileExist(e){return r.existsSync(e)}static GetDirName(e){let t=this.IsFileOrDir(e);if(t==a.EFileType.NotExist)return"";let n=(e=l.default.ReplaceAll(e,"\\","/")).split("/");return e.endsWith("/")||t==a.EFileType.File?n[n.length-2]:n[n.length-1]}static WriteStrTo(e,t){let n=e.lastIndexOf("\\"),i=e.substring(0,n);c.MakeDirExist(i),r.writeFileSync(e,t,{encoding:"utf-8"})}static Rename(e,t){r.renameSync(e,t)}}t.LTUtils=c},function(e,t){e.exports=require("uglify-es")},function(e,t){e.exports=require("child_process")},function(e,t,n){e.exports=n(25),e.exports.Constants=n(11),e.exports.Errors=n(26),e.exports.FileAttr=n(27)},,function(e,t,n){t.require=function(){if("object"==typeof process&&process.versions&&process.versions.electron)try{const e=n(!function(){var e=new Error("Cannot find module 'original-fs'");throw e.code="MODULE_NOT_FOUND",e}());if(Object.keys(e).length>0)return e}catch(e){}return n(1)}},function(e,t){e.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}},function(e,t,n){var r=n(8),i=n(13),o=r.Constants,s=n(30);e.exports=function(e){var t=new i.EntryHeader,n=Buffer.alloc(0),a=Buffer.alloc(0),l=!1,c=null,f=Buffer.alloc(0);function u(){return e&&Buffer.isBuffer(e)?(t.loadDataHeaderFromBinary(e),e.slice(t.realDataOffset,t.realDataOffset+t.compressedSize)):Buffer.alloc(0)}function h(e){return 8==(8&t.flags)||r.crc32(e)===t.dataHeader.crc}function d(e,i,o){if(void 0===i&&"string"==typeof e&&(o=e,e=void 0),l)return e&&i&&i(Buffer.alloc(0),r.Errors.DIRECTORY_CONTENT_ERROR),Buffer.alloc(0);var a=u();if(0===a.length)return e&&i&&i(a),a;if(t.encripted){if("string"!=typeof o&&!Buffer.isBuffer(o))throw new Error("ADM-ZIP: Incompatible password parameter");a=s.ZipCrypto.decrypt(a,t,o)}var c=Buffer.alloc(t.size);switch(t.method){case r.Constants.STORED:if(a.copy(c),h(c))return e&&i&&i(c),c;throw e&&i&&i(c,r.Errors.BAD_CRC),new Error(r.Errors.BAD_CRC);case r.Constants.DEFLATED:var f=new s.Inflater(a);if(!e){if(f.inflate(c).copy(c,0),!h(c))throw new Error(r.Errors.BAD_CRC+" "+n.toString());return c}f.inflateAsync((function(e){e.copy(e,0),i&&(h(e)?i(e):i(e,r.Errors.BAD_CRC))}));break;default:throw e&&i&&i(Buffer.alloc(0),r.Errors.UNKNOWN_METHOD),new Error(r.Errors.UNKNOWN_METHOD)}}function p(n,i){if((!c||!c.length)&&Buffer.isBuffer(e))return n&&i&&i(u()),u();if(c.length&&!l){var o;switch(t.method){case r.Constants.STORED:return t.compressedSize=t.size,o=Buffer.alloc(c.length),c.copy(o),n&&i&&i(o),o;default:case r.Constants.DEFLATED:var a=new s.Deflater(c);if(!n){var f=a.deflate();return t.compressedSize=f.length,f}a.deflateAsync((function(e){o=Buffer.alloc(e.length),t.compressedSize=e.length,e.copy(o),i&&i(o)})),a=null}}else{if(!n||!i)return Buffer.alloc(0);i(Buffer.alloc(0))}}function E(e,t){return(e.readUInt32LE(t+4)<<4)+e.readUInt32LE(t)}function g(e){var n,r,i,s;e.length>=o.EF_ZIP64_SCOMP&&(n=E(e,o.EF_ZIP64_SUNCOMP),t.size===o.EF_ZIP64_OR_32&&(t.size=n)),e.length>=o.EF_ZIP64_RHO&&(r=E(e,o.EF_ZIP64_SCOMP),t.compressedSize===o.EF_ZIP64_OR_32&&(t.compressedSize=r)),e.length>=o.EF_ZIP64_DSN&&(i=E(e,o.EF_ZIP64_RHO),t.offset===o.EF_ZIP64_OR_32&&(t.offset=i)),e.length>=o.EF_ZIP64_DSN+4&&(s=e.readUInt32LE(o.EF_ZIP64_DSN),t.diskNumStart===o.EF_ZIP64_OR_16&&(t.diskNumStart=s))}return{get entryName(){return n.toString()},get rawEntryName(){return n},set entryName(e){var i=(n=r.toBuffer(e))[n.length-1];l=47===i||92===i,t.fileNameLength=n.length},get extra(){return f},set extra(e){f=e,t.extraLength=e.length,function(e){for(var t,n,r,i=0;i<e.length;)t=e.readUInt16LE(i),i+=2,n=e.readUInt16LE(i),i+=2,r=e.slice(i,i+n),i+=n,o.ID_ZIP64===t&&g(r)}(e)},get comment(){return a.toString()},set comment(e){a=r.toBuffer(e),t.commentLength=a.length},get name(){var e=n.toString();return l?e.substr(e.length-1).split("/").pop():e.split("/").pop()},get isDirectory(){return l},getCompressedData:function(){return p(!1,null)},getCompressedDataAsync:function(e){p(!0,e)},setData:function(e){c=r.toBuffer(e),!l&&c.length?(t.size=c.length,t.method=r.Constants.DEFLATED,t.crc=r.crc32(e),t.changed=!0):t.method=r.Constants.STORED},getData:function(e){return t.changed?c:d(!1,null,e)},getDataAsync:function(e,n){t.changed?e(c):d(!0,e,n)},set attr(e){t.attr=e},get attr(){return t.attr},set header(e){t.loadFromBinary(e)},get header(){return t},packHeader:function(){var e=t.entryHeaderToBinary(),i=r.Constants.CENHDR;return n.copy(e,i),i+=n.length,t.extraLength&&(f.copy(e,i),i+=t.extraLength),t.commentLength&&a.copy(e,i),e},toJSON:function(){const n=function(e){return"<"+(e&&e.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:t.toJSON(),compressedData:n(e),data:n(c)}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}}},function(e,t,n){t.EntryHeader=n(28),t.MainHeader=n(29)},function(e,t){e.exports=require("zlib")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EPackResolveType=void 0,function(e){e[e.AutoSearch=0]="AutoSearch",e[e.AllIn=1]="AllIn",e[e.AllOut=2]="AllOut"}(t.EPackResolveType||(t.EPackResolveType={}))},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(20);new class{constructor(){let e=this._GetParam("-p");null!=e?new i.PublishHandler(e).Start():console.log("需要传入-p 平台参数")}_GetParam(e){let t=r.argv.indexOf(e);return t<0?null:r.argv[t+1]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PublishHandler=void 0;const r=n(0),i=n(1),o=n(4),s=n(21),a=n(22),l=n(6),c=n(23),f=n(24),u=n(5),h=n(36),d=n(3),p=n(38);t.PublishHandler=class{constructor(e){this._keepPlatforms={wx:["project.config.json","game.json"],tt:["project.config.json","game.json"],gamebox4399:["project.config.json","game.json"],qq:["project.config.json","game.json"],oppo:["manifest.json","icon.png"],hw:["manifest.json","icon.png"]},this._platformStr=e}Start(){let e=Date.now();console.log("开始发布",s.green(this._platformStr)),this._InitAll(),this._CheckRelease(),this._CopyTemplate(),this._CopyBin(),this._CopyOpenDataContext(),this._makeRPK(),console.log(("注意cdn资源,需要拷贝到服务器:"+this._cdnPath).bgRed);let t=((Date.now()-e)/1e3).toFixed(2);console.log("发布完成",this._releasePath.green),console.log("总共耗时 "+t.green+" 秒")}_RPK_OPPO(){this.unzipTool(this._platformStr),c.cd(this._releasePath);let e=r.join(this._workPath,"./others/publish/tools/oppo/lib/bin/index.js"),t=this._packConfig.isDebug?"debug":"release";c.exec(`node ${e} pack ${t}`)}_RPK_VIVO(){c.cd(this._releasePath);let e=r.join(this._releasePath,"node_modules");i.existsSync(e)||(console.log("没有vivo快应用所需node模块,执行 npm install "),c.exec("npm install")),c.exec("npm run release"),c.exec("npm run server")}_RPK_HW(){this.unzipTool(this._platformStr);let e=r.join(this._releasePath,"manifest.json"),t=u.LTUtils.ReadStrFrom(e),o=JSON.parse(t).package;o=this._packConfig.isDebug?o:o+".signed";let s=r.join(this._releasePath,"dist"),a=r.join(s,o+".rpk");c.rm("-rf",s),console.log("make hw rpk"),c.cd(this._releasePath);let l=r.join(this._workPath,"./others/publish/tools/hw/index.js"),f=this._packConfig.isDebug?"debug":"release",h=r.join(this._releasePath,"sign",f,"private.pem"),d=r.join(this._releasePath,"sign",f,"certificate.pem"),p=[`"${l}"`,`"${this._releasePath}"`,`"${s}"`,o,`"${h}"`,`"${d}"`],E={cwd:this._workPath,shell:!0};let g=n(7).spawnSync("node",p,E);if(console.log("stdout: "+g.stdout),console.log("stderr: "+g.stderr),!i.existsSync(a))throw new Error("rpk生成失败，请检查！");console.log("华为发布完成：",a.green)}_ZipHtml4399(){c.exec("node others/publish/tools/tools.js check html4399"),c.cd(this._workPath);let e=r.join(this._releasePath),t=r.join(this._releasePath,"html4399_dist.zip");i.existsSync(t)&&(console.log(t),i.unlinkSync(t));let n=new f;n.addLocalFolder(e),n.writeZip(t)}_makeRPK(){switch(this._platformStr){case"oppo":this._RPK_OPPO();break;case"vivo":this._RPK_VIVO();break;case"hw":this._RPK_HW();break;case"html4399":this._ZipHtml4399()}}unzipTool(e){let t=r.join(this._workPath,"./others/publish/tools/"+e);if(console.log("unzip:",t),i.existsSync(t))console.log("已解压,跳过解压");else{console.log("开始解压,请勿中断..."),new f(`./others/publish/tools/${e}.zip`).extractAllTo(t),console.log("解压完成"),console.trace}}_CopyBin(){let e=r.join(this._releasePath,"./res/");u.LTUtils.DeleteDir(e);let t=r.join(this._binPath,"./res/"),n=r.join(this._cdnPath,"./res/"),i=new h.SubpackHelper(t,this._packConfig);i.single_max_size=1024*this._packConfig.maxSinglePackSize*1024,i.total_max_size=1024*this._packConfig.maxTotalPackSize*1024,i.Analyze(),i.Replace(e,n),this._CopyIndex(),console.log("bin目录拷贝完成"),console.log()}_CopyIndex(){let e=r.join(this._binPath,"./index.js"),t=u.LTUtils.ReadStrFrom(e);if(this._packConfig.compress){console.log("当前配置需要压缩js,开始压缩");var n=Date.now()}let o=r.join(this._workPath,"./temp/"+this._platformStr+"/");u.LTUtils.MakeDirExist(o);let s=t;s=this._packConfig.openDataContext?s.replace("//openContext",""):s.replace('loadLib("libs/laya.ui.js");',"");let c,f=/loadLib\("(.*)"\)/gm;for(;null!==(c=f.exec(s));)if(c.index===f.lastIndex&&f.lastIndex++,c[1]){let e=c[1],t=r.join(this._binPath,e);console.log(t.green);let n=r.join(this._releasePath,e),s=n.lastIndexOf("\\"),f=n.substring(0,s);u.LTUtils.MakeDirExist(f);let h=this._packConfig.es5;if(h&&(e.endsWith("bundle.js")||(h=!1)),h){console.log("进行转es5操作 "+n.green);let e=a.transformFileSync(t,{presets:["@babel/preset-env"],babelrc:!1}).code;this._packConfig.compress&&(e=l.minify(e).code),u.LTUtils.WriteStrTo(n,e)}else this._packConfig.compress?this._DoCacheCompress(e,t,o,n):i.copyFileSync(t,n)}let h=r.join(this._releasePath,"./index.js");if(u.LTUtils.WriteStrTo(h,s),this._packConfig.compress){this._DoCacheCompress("index.js",h,o,h);let e=((Date.now()-n)/1e3).toFixed(2);console.log("压缩完成,总共耗时 "+e.green+" 秒")}else console.log("当前配置无需压缩,直接拷贝所有js文件"),u.LTUtils.WriteStrTo(h,s);if("oppo"==this._packConfig.platform||"vivo"==this._packConfig.platform||"hw"==this._packConfig.platform){let t=u.LTUtils.ReadStrFrom(h),n="____";if(t=u.LTUtils.ReplaceAll(t,'loadLib("',n),t=u.LTUtils.ReplaceAll(t,n,'require("./'),u.LTUtils.WriteStrTo(h,t),console.log(this._packConfig.platform+" 平台重写index.js",e),"vivo"==this._packConfig.platform){let e=h.replace("index.js","src/index.js");i.writeFileSync(e,t);let n=t.split('require("'),r=h.replace("index.js","minigame.config.js"),o=[{module_name:"./libs/laya.vvmini.js",module_path:"./libs/laya.vvmini.js",module_from:"../../bin/libs/laya.vvmini.js"}];for(let e=1;e<n.length;e++){let t=n[e].replace('"),',"").replace('");',""),r={module_name:t,module_path:t,module_from:t.replace("./","")};o.push(r)}let s=i.readFileSync(r,{encoding:"utf-8"});s=s.replace("const externals = []",`const externals =${JSON.stringify(o)};`),i.writeFileSync(r,s,{encoding:"utf-8"});let a=h.replace("index.js","res"),l=h.replace("index.js","src\\res");u.LTUtils.DeleteDir(l),i.renameSync(a,l),console.log("vivo 复制 res 完成")}}}_DoCacheCompress(e,t,n,o){let s=i.statSync(t).mtimeMs,a=r.join(n,e),l=u.LTUtils.ReadStrFrom(a);if(d.default.IsNullOrEmpty(l)){let n={fileName:e,modifyTime:s,compressJs:u.LTUtils.CompressJs(t,o)},r=JSON.stringify(n);u.LTUtils.WriteStrTo(a,r)}else{let n=JSON.parse(l),r=n.fileName,i=n.modifyTime;if(e==r&&i==s)console.log("文件未变动,直接使用缓存文件进行替换",e.green),u.LTUtils.WriteStrTo(o,n.compressJs);else{let n={fileName:e,modifyTime:s,compressJs:u.LTUtils.CompressJs(t,o)},r=JSON.stringify(n);u.LTUtils.WriteStrTo(a,r)}}}_CopyTemplate(){u.LTUtils.CopyDir(this._templatePath,this._releasePath,e=>{if(this._keepFiles.indexOf(e)>=0){let t=r.join(this._releasePath,e);if(i.existsSync(t))return console.log("检测到已存在",e.green,"进行保留"),!1}return!0}),console.log("template拷贝完成"),console.log()}_CopyOpenDataContext(){if(this._packConfig.openDataContext){let e=r.join(this._releasePath,"./openDataContext/");u.LTUtils.CopyDir(this._openDataContextPath,e),console.log("开放域工程".bgRed,"openDataContext 目录拷贝完成".green)}else console.log("不是开放域工程,无需拷贝 openDataContext")}_CheckRelease(){if(!u.LTUtils.MakeDirExist(this._releasePath))throw console.log("release路径检查","失败".red),SyntaxError("release路径创建失败,请检查权限");console.log("release路径检查","通过".green),console.log()}_InitAll(){this._workPath=o.cwd();let e=r.join(this._workPath,"./pack_config/publish."+this._platformStr+".json");u.LTUtils.IsFileExist(e)||(console.log("当前平台",this._platformStr,"不存在打包配置文件",e.red,"读取默认配置"),e=r.join(this._workPath,"./others/config/publish.default.json"));let t=u.LTUtils.ReadStrFrom(e),n=JSON.parse(t);this._packConfig=new p.LTPackConfig,this._packConfig.platform=this._platformStr;for(let e in n)this._packConfig[e]=n[e];this._releasePath=r.join(this._workPath,"./release/"+this._platformStr),this._templatePath=r.join(this._workPath,"./others/publish/templates/"+this._platformStr),this._openDataContextPath=r.join(this._workPath,"./others/publish/templates/openDataContext"),this._binPath=r.join(this._workPath,"./bin/"),this._cdnPath=r.join(this._workPath,"./cdn/"+this._platformStr),console.log("release路径",this._releasePath.green),this._keepFiles=this._keepPlatforms[this._platformStr],this._keepFiles||(console.log("当前平台未配置keepFiles",this._platformStr),this._keepFiles=[]),console.log()}}},function(e,t){e.exports=require("colors")},function(e,t){e.exports=require("@babel/core")},function(e,t){e.exports=require("shelljs")},function(e,t,n){const r=n(8),i=n(0),o=n(12),s=n(35),a=(e,t)=>"boolean"==typeof e?e:t,l=(e,t)=>"string"==typeof e?e:t,c={noSort:!1,readEntries:!1,method:r.Constants.NONE,fs:null};e.exports=function(e,t){let n=null;const f=Object.assign(Object.create(null),c);e&&"object"==typeof e&&(e instanceof Uint8Array||(Object.assign(f,e),e=f.input?f.input:void 0,f.input&&delete f.input),Buffer.isBuffer(e)&&(n=e,f.method=r.Constants.BUFFER,e=void 0)),Object.assign(f,t);const u=new r(f);if(e&&"string"==typeof e){if(!u.fs.existsSync(e))throw new Error(r.Errors.INVALID_FILENAME);f.method=r.Constants.FILE,f.filename=e,n=u.fs.readFileSync(e)}const h=new s(n,f),{canonical:d,sanitize:p}=r;function E(e){var t;if(e&&h&&("string"==typeof e&&(t=h.getEntry(e)),"object"==typeof e&&void 0!==e.entryName&&void 0!==e.header&&(t=h.getEntry(e.entryName)),t))return t;return null}function g(e){const{join:t,normalize:n,sep:r}=i.posix;return t(".",n(r+e.split("\\").join(r)+r))}return{readFile:function(e,t){var n=E(e);return n&&n.getData(t)||null},readFileAsync:function(e,t){var n=E(e);n?n.getDataAsync(t):t(null,"getEntry failed for:"+e)},readAsText:function(e,t){var n=E(e);if(n){var r=n.getData();if(r&&r.length)return r.toString(t||"utf8")}return""},readAsTextAsync:function(e,t,n){var r=E(e);r?r.getDataAsync((function(e,r){r?t(e,r):e&&e.length?t(e.toString(n||"utf8")):t("")})):t("")},deleteFile:function(e){var t=E(e);t&&h.deleteEntry(t.entryName)},addZipComment:function(e){h.comment=e},getZipComment:function(){return h.comment||""},addZipEntryComment:function(e,t){var n=E(e);n&&(n.comment=t)},getZipEntryComment:function(e){var t=E(e);return t&&t.comment||""},updateFile:function(e,t){var n=E(e);n&&n.setData(t)},addLocalFile:function(e,t,n,i){if(!u.fs.existsSync(e))throw new Error(r.Errors.FILE_NOT_FOUND.replace("%s",e));{t=t?g(t):"";var o=e.split("\\").join("/").split("/").pop();t+=n||o;const r=u.fs.statSync(e);this.addFile(t,u.fs.readFileSync(e),i,r)}},addLocalFolder:function(e,t,n){var o;if(n instanceof RegExp?(o=n,n=function(e){return o.test(e)}):"function"!=typeof n&&(n=function(){return!0}),t=t?g(t):"",e=i.normalize(e),!u.fs.existsSync(e))throw new Error(r.Errors.FILE_NOT_FOUND.replace("%s",e));{const r=u.findFiles(e),o=this;r.length&&r.forEach((function(r){var s=i.relative(e,r).split("\\").join("/");if(n(s)){var a=u.fs.statSync(r);a.isFile()?o.addFile(t+s,u.fs.readFileSync(r),"",a):o.addFile(t+s+"/",Buffer.alloc(0),"",a)}}))}},addLocalFolderAsync:function(e,t,n,o){var s;o instanceof RegExp?(s=o,o=function(e){return s.test(e)}):"function"!=typeof o&&(o=function(){return!0}),n=n?g(n):"",e=i.normalize(e);var a=this;u.fs.open(e,"r",(function(s){if(s&&"ENOENT"===s.code)t(void 0,r.Errors.FILE_NOT_FOUND.replace("%s",e));else if(s)t(void 0,s);else{var l=u.findFiles(e),c=-1,f=function(){if((c+=1)<l.length){var r=l[c],s=i.relative(e,r).split("\\").join("/");s=s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),o(s)?u.fs.stat(r,(function(e,i){e&&t(void 0,e),i.isFile()?u.fs.readFile(r,(function(e,r){e?t(void 0,e):(a.addFile(n+s,r,"",i),f())})):(a.addFile(n+s+"/",Buffer.alloc(0),"",i),f())})):f()}else t(!0,void 0)};f()}}))},addLocalFolderPromise:function(e,t){return new Promise((n,r)=>{const{filter:i,zipPath:o}=Object.assign({},t);this.addLocalFolderAsync(e,(e,t)=>{t&&r(t),e&&n(this)},o,i)})},addFile:function(e,t,n,i){let s=E(e);const a=null!=s;a||(s=new o,s.entryName=e),s.comment=n||"";const l="object"==typeof i&&i instanceof u.fs.Stats;l&&(s.header.time=i.mtime);var c=s.isDirectory?16:0;if(!r.isWin){let e=s.isDirectory?16384:32768;e|=l?4095&i.mode:"number"==typeof i?4095&i:s.isDirectory?493:420,c=(c|e<<16)>>>0}s.attr=c,s.setData(t),a||h.setEntry(s)},getEntries:function(){return h?h.entries:[]},getEntry:function(e){return E(e)},getEntryCount:function(){return h.getEntryCount()},forEach:function(e){return h.forEach(e)},extractEntryTo:function(e,t,n,o,s,c){o=a(o,!1),s=a(s,!1),n=a(n,!0),c=l(c,l(s,void 0));var f=E(e);if(!f)throw new Error(r.Errors.NO_ENTRY);var g=d(f.entryName),m=p(t,c&&!f.isDirectory?c:n?g:i.basename(g));if(f.isDirectory)return h.getEntryChildren(f).forEach((function(e){if(e.isDirectory)return;var a=e.getData();if(!a)throw new Error(r.Errors.CANT_EXTRACT_FILE);var l=d(e.entryName),c=p(t,n?l:i.basename(l));const f=s?e.header.fileAttr:void 0;u.writeFileTo(c,a,o,f)})),!0;var y=f.getData();if(!y)throw new Error(r.Errors.CANT_EXTRACT_FILE);if(u.fs.existsSync(m)&&!o)throw new Error(r.Errors.CANT_OVERRIDE);const _=s?e.header.fileAttr:void 0;return u.writeFileTo(m,y,o,_),!0},test:function(e){if(!h)return!1;for(var t in h.entries)try{if(t.isDirectory)continue;if(!h.entries[t].getData(e))return!1}catch(e){return!1}return!0},extractAllTo:function(e,t,n,i){if(t=a(t,!1),i=l(n,i),n=a(n,!1),!h)throw new Error(r.Errors.NO_ZIP);h.entries.forEach((function(o){var s=p(e,d(o.entryName.toString()));if(o.isDirectory)return void u.makeDir(s);var a=o.getData(i);if(!a)throw new Error(r.Errors.CANT_EXTRACT_FILE);const l=n?o.header.fileAttr:void 0;u.writeFileTo(s,a,t,l);try{u.fs.utimesSync(s,o.header.time,o.header.time)}catch(e){throw new Error(r.Errors.CANT_EXTRACT_FILE)}}))},extractAllToAsync:function(e,t,n,o){if(o||(o=function(){}),t=a(t,!1),"function"!=typeof n||o||(o=n),n=a(n,!1),!h)return void o(new Error(r.Errors.NO_ZIP));e=i.resolve(e);const s=t=>p(e,i.normalize(d(t.entryName.toString()))),l=(e,t)=>new Error(e+': "'+t+'"'),c=[],f=new Set;h.entries.forEach(e=>{e.isDirectory?c.push(e):f.add(e)});for(const e of c){const t=s(e),r=n?e.header.fileAttr:void 0;try{u.makeDir(t),r&&u.fs.chmodSync(t,r),u.fs.utimesSync(t,e.header.time,e.header.time)}catch(e){o(l("Unable to create folder",t))}}const E=()=>{0===f.size&&o()};for(const s of f.values()){const a=i.normalize(d(s.entryName.toString())),c=p(e,a);s.getDataAsync((function(e,i){if(i)o(new Error(i));else if(e){const r=n?s.header.fileAttr:void 0;u.writeFileToAsync(c,e,t,r,(function(e){e?u.fs.utimes(c,s.header.time,s.header.time,(function(e){e?o(l("Unable to set times",c)):(f.delete(s),E())})):o(l("Unable to write file",c))}))}else o(new Error(r.Errors.CANT_EXTRACT_FILE))}))}E()},writeZip:function(e,t){if(1===arguments.length&&"function"==typeof e&&(t=e,e=""),!e&&f.filename&&(e=f.filename),e){var n=h.compressToBuffer();if(n){var r=u.writeFileTo(e,n,!0);"function"==typeof t&&t(r?null:new Error("failed"),"")}}},writeZipPromise:function(e,t){const{overwrite:n,perm:r}=Object.assign({overwrite:!0},t);return new Promise((t,i)=>{!e&&f.filename&&(e=f.filename),e||i("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(o=>{u.writeFileToAsync(e,o,n,r,e=>e?t(e):i("ADM-ZIP: Wasn't able to write zip file"))},i)})},toBufferPromise:function(){return new Promise((e,t)=>{h.toAsyncBuffer(e,t)})},toBuffer:function(e,t,n,r){return this.valueOf=2,"function"==typeof e?(h.toAsyncBuffer(e,t,n,r),null):h.compressToBuffer()}}}},function(e,t,n){const r=n(10).require(),i=n(0),o=n(11),s="object"==typeof process&&"win32"===process.platform,a=e=>e&&"object"==typeof e,l=new Uint32Array(256).map((e,t)=>{for(let e=0;e<8;e++)0!=(1&t)?t=3988292384^t>>>1:t>>>=1;return t>>>0});function c(e){this.sep=i.sep,this.fs=r,a(e)&&a(e.fs)&&"function"==typeof e.fs.statSync&&(this.fs=e.fs)}e.exports=c,c.prototype.makeDir=function(e){const t=this;!function(e){let n=e.split(t.sep)[0];e.split(t.sep).forEach((function(e){if(e&&":"!==e.substr(-1,1)){var r;n+=t.sep+e;try{r=t.fs.statSync(n)}catch(e){t.fs.mkdirSync(n)}if(r&&r.isFile())throw Errors.FILE_IN_THE_WAY.replace("%s",n)}}))}(e)},c.prototype.writeFileTo=function(e,t,n,r){const o=this;if(o.fs.existsSync(e)){if(!n)return!1;if(o.fs.statSync(e).isDirectory())return!1}var s,a=i.dirname(e);o.fs.existsSync(a)||o.makeDir(a);try{s=o.fs.openSync(e,"w",438)}catch(t){o.fs.chmodSync(e,438),s=o.fs.openSync(e,"w",438)}if(s)try{o.fs.writeSync(s,t,0,t.length,0)}finally{o.fs.closeSync(s)}return o.fs.chmodSync(e,r||438),!0},c.prototype.writeFileToAsync=function(e,t,n,r,o){"function"==typeof r&&(o=r,r=void 0);const s=this;s.fs.exists(e,(function(a){if(a&&!n)return o(!1);s.fs.stat(e,(function(n,l){if(a&&l.isDirectory())return o(!1);var c=i.dirname(e);s.fs.exists(c,(function(n){n||s.makeDir(c),s.fs.open(e,"w",438,(function(n,i){n?s.fs.chmod(e,438,(function(){s.fs.open(e,"w",438,(function(n,i){s.fs.write(i,t,0,t.length,0,(function(){s.fs.close(i,(function(){s.fs.chmod(e,r||438,(function(){o(!0)}))}))}))}))})):i?s.fs.write(i,t,0,t.length,0,(function(){s.fs.close(i,(function(){s.fs.chmod(e,r||438,(function(){o(!0)}))}))})):s.fs.chmod(e,r||438,(function(){o(!0)}))}))}))}))}))},c.prototype.findFiles=function(e){const t=this;return function e(n,r,o){"boolean"==typeof r&&(o=r,r=void 0);let s=[];return t.fs.readdirSync(n).forEach((function(a){var l=i.join(n,a);t.fs.statSync(l).isDirectory()&&o&&(s=s.concat(e(l,r,o))),r&&!r.test(l)||s.push(i.normalize(l)+(t.fs.statSync(l).isDirectory()?t.sep:""))})),s}(e,void 0,!0)},c.prototype.getAttributes=function(){},c.prototype.setAttributes=function(){},c.crc32update=function(e,t){return l[255&(e^t)]^e>>>8},c.crc32=function(e){"string"==typeof e&&(e=Buffer.from(e,"utf8")),l.length||genCRCTable();let t=e.length,n=-1;for(let r=0;r<t;)n=c.crc32update(n,e[r++]);return~n>>>0},c.methodToString=function(e){switch(e){case o.STORED:return"STORED ("+e+")";case o.DEFLATED:return"DEFLATED ("+e+")";default:return"UNSUPPORTED ("+e+")"}},c.canonical=function(e){if(!e)return"";var t=i.posix.normalize("/"+e.split("\\").join("/"));return i.join(".",t)},c.sanitize=function(e,t){e=i.resolve(i.normalize(e));for(var n=t.split("/"),r=0,o=n.length;r<o;r++){var s=i.normalize(i.join(e,n.slice(r,o).join(i.sep)));if(0===s.indexOf(e))return s}return i.normalize(i.join(e,i.basename(t)))},c.toBuffer=function(e){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):"string"==typeof e?Buffer.from(e,"utf8"):Buffer.alloc(0)},c.readBigUInt64LE=function(e,t){var n=Buffer.from(e.slice(t,t+8));return n.swap64(),parseInt("0x"+n.toString("hex"))},c.isWin=s,c.crcTable=l},function(e,t){e.exports={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed",FILE_IN_THE_WAY:"There is a file in the way: %s",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:"File not found: %s",NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found"}},function(e,t,n){const r=n(10).require(),i=n(0);r.existsSync=r.existsSync||i.existsSync,e.exports=function(e){var t=e||"",n={directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0},o=null;return t&&r.existsSync(t)?(o=r.statSync(t),n.directory=o.isDirectory(),n.mtime=o.mtime,n.atime=o.atime,n.executable=0!=(73&o.mode),n.readonly=0==(128&o.mode),n.hidden="."===i.basename(t)[0]):console.warn("Invalid path: "+t),{get directory(){return n.directory},get readOnly(){return n.readonly},get hidden(){return n.hidden},get mtime(){return n.mtime},get atime(){return n.atime},get executable(){return n.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:n.directory,isReadOnly:n.readonly,isHidden:n.hidden,isExecutable:n.executable,mTime:n.mtime,aTime:n.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}}},function(e,t,n){var r=n(8),i=r.Constants;e.exports=function(){var e=20,t=10,n=0,o=0,s=0,a=0,l=0,c=0,f=0,u=0,h=0,d=0,p=0,E=0,g=0;e|=r.isWin?2560:768,n|=i.FLG_EFS;var m={};function y(e){e=new Date(e),s=(e.getFullYear()-1980&127)<<25|e.getMonth()+1<<21|e.getDate()<<16|e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()>>1}return y(+new Date),{get made(){return e},set made(t){e=t},get version(){return t},set version(e){t=e},get flags(){return n},set flags(e){n=e},get method(){return o},set method(e){switch(e){case i.STORED:this.version=10;case i.DEFLATED:default:this.version=20}o=e},get time(){return new Date(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1)},set time(e){y(e)},get crc(){return a},set crc(e){a=Math.max(0,e)>>>0},get compressedSize(){return l},set compressedSize(e){l=Math.max(0,e)>>>0},get size(){return c},set size(e){c=Math.max(0,e)>>>0},get fileNameLength(){return f},set fileNameLength(e){f=e},get extraLength(){return u},set extraLength(e){u=e},get commentLength(){return h},set commentLength(e){h=e},get diskNumStart(){return d},set diskNumStart(e){d=Math.max(0,e)>>>0},get inAttr(){return p},set inAttr(e){p=Math.max(0,e)>>>0},get attr(){return E},set attr(e){E=Math.max(0,e)>>>0},get fileAttr(){return E?(E>>>0|0)>>16&4095:0},get offset(){return g},set offset(e){g=Math.max(0,e)>>>0},get encripted(){return 1==(1&n)},get entryHeaderSize(){return i.CENHDR+f+u+h},get realDataOffset(){return g+i.LOCHDR+m.fnameLen+m.extraLen},get dataHeader(){return m},loadDataHeaderFromBinary:function(e){var t=e.slice(g,g+i.LOCHDR);if(t.readUInt32LE(0)!==i.LOCSIG)throw new Error(r.Errors.INVALID_LOC);m={version:t.readUInt16LE(i.LOCVER),flags:t.readUInt16LE(i.LOCFLG),method:t.readUInt16LE(i.LOCHOW),time:t.readUInt32LE(i.LOCTIM),crc:t.readUInt32LE(i.LOCCRC),compressedSize:t.readUInt32LE(i.LOCSIZ),size:t.readUInt32LE(i.LOCLEN),fnameLen:t.readUInt16LE(i.LOCNAM),extraLen:t.readUInt16LE(i.LOCEXT)}},loadFromBinary:function(m){if(m.length!==i.CENHDR||m.readUInt32LE(0)!==i.CENSIG)throw new Error(r.Errors.INVALID_CEN);e=m.readUInt16LE(i.CENVEM),t=m.readUInt16LE(i.CENVER),n=m.readUInt16LE(i.CENFLG),o=m.readUInt16LE(i.CENHOW),s=m.readUInt32LE(i.CENTIM),a=m.readUInt32LE(i.CENCRC),l=m.readUInt32LE(i.CENSIZ),c=m.readUInt32LE(i.CENLEN),f=m.readUInt16LE(i.CENNAM),u=m.readUInt16LE(i.CENEXT),h=m.readUInt16LE(i.CENCOM),d=m.readUInt16LE(i.CENDSK),p=m.readUInt16LE(i.CENATT),E=m.readUInt32LE(i.CENATX),g=m.readUInt32LE(i.CENOFF)},dataHeaderToBinary:function(){var e=Buffer.alloc(i.LOCHDR);return e.writeUInt32LE(i.LOCSIG,0),e.writeUInt16LE(t,i.LOCVER),e.writeUInt16LE(n,i.LOCFLG),e.writeUInt16LE(o,i.LOCHOW),e.writeUInt32LE(s,i.LOCTIM),e.writeUInt32LE(a,i.LOCCRC),e.writeUInt32LE(l,i.LOCSIZ),e.writeUInt32LE(c,i.LOCLEN),e.writeUInt16LE(f,i.LOCNAM),e.writeUInt16LE(u,i.LOCEXT),e},entryHeaderToBinary:function(){var r=Buffer.alloc(i.CENHDR+f+u+h);return r.writeUInt32LE(i.CENSIG,0),r.writeUInt16LE(e,i.CENVEM),r.writeUInt16LE(t,i.CENVER),r.writeUInt16LE(n,i.CENFLG),r.writeUInt16LE(o,i.CENHOW),r.writeUInt32LE(s,i.CENTIM),r.writeUInt32LE(a,i.CENCRC),r.writeUInt32LE(l,i.CENSIZ),r.writeUInt32LE(c,i.CENLEN),r.writeUInt16LE(f,i.CENNAM),r.writeUInt16LE(u,i.CENEXT),r.writeUInt16LE(h,i.CENCOM),r.writeUInt16LE(d,i.CENDSK),r.writeUInt16LE(p,i.CENATT),r.writeUInt32LE(E,i.CENATX),r.writeUInt32LE(g,i.CENOFF),r.fill(0,i.CENHDR),r},toJSON:function(){const s=function(e){return e+" bytes"};return{made:e,version:t,flags:n,method:r.methodToString(o),time:this.time,crc:"0x"+a.toString(16).toUpperCase(),compressedSize:s(l),size:s(c),fileNameLength:s(f),extraLength:s(u),commentLength:s(h),diskNumStart:d,inAttr:p,attr:E,offset:g,entryHeaderSize:s(i.CENHDR+f+u+h)}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}}},function(e,t,n){var r=n(8),i=r.Constants;e.exports=function(){var e=0,t=0,n=0,o=0,s=0;return{get diskEntries(){return e},set diskEntries(n){e=t=n},get totalEntries(){return t},set totalEntries(n){t=e=n},get size(){return n},set size(e){n=e},get offset(){return o},set offset(e){o=e},get commentLength(){return s},set commentLength(e){s=e},get mainHeaderSize(){return i.ENDHDR+s},loadFromBinary:function(a){if((a.length!==i.ENDHDR||a.readUInt32LE(0)!==i.ENDSIG)&&(a.length<i.ZIP64HDR||a.readUInt32LE(0)!==i.ZIP64SIG))throw new Error(r.Errors.INVALID_END);a.readUInt32LE(0)===i.ENDSIG?(e=a.readUInt16LE(i.ENDSUB),t=a.readUInt16LE(i.ENDTOT),n=a.readUInt32LE(i.ENDSIZ),o=a.readUInt32LE(i.ENDOFF),s=a.readUInt16LE(i.ENDCOM)):(e=r.readBigUInt64LE(a,i.ZIP64SUB),t=r.readBigUInt64LE(a,i.ZIP64TOT),n=r.readBigUInt64LE(a,i.ZIP64SIZ),o=r.readBigUInt64LE(a,i.ZIP64OFF),s=0)},toBinary:function(){var r=Buffer.alloc(i.ENDHDR+s);return r.writeUInt32LE(i.ENDSIG,0),r.writeUInt32LE(0,4),r.writeUInt16LE(e,i.ENDSUB),r.writeUInt16LE(t,i.ENDTOT),r.writeUInt32LE(n,i.ENDSIZ),r.writeUInt32LE(o,i.ENDOFF),r.writeUInt16LE(s,i.ENDCOM),r.fill(" ",i.ENDHDR),r},toJSON:function(){return{diskEntries:e,totalEntries:t,size:n+" bytes",offset:function(e,t){let n=e.toString(16).toUpperCase();for(;n.length<t;)n="0"+n;return"0x"+n}(o,4),commentLength:s}},toString:function(){return JSON.stringify(this.toJSON(),null,"\t")}}}},function(e,t,n){t.Deflater=n(31),t.Inflater=n(32),t.ZipCrypto=n(33)},function(e,t,n){e.exports=function(e){var t=n(14),r={chunkSize:1024*(parseInt(e.length/1024)+1)};return{deflate:function(){return t.deflateRawSync(e,r)},deflateAsync:function(n){var i=t.createDeflateRaw(r),o=[],s=0;i.on("data",(function(e){o.push(e),s+=e.length})),i.on("end",(function(){var e=Buffer.alloc(s),t=0;e.fill(0);for(var r=0;r<o.length;r++){var i=o[r];i.copy(e,t),t+=i.length}n&&n(e)})),i.end(e)}}}},function(e,t,n){e.exports=function(e){var t=n(14);return{inflate:function(){return t.inflateRawSync(e)},inflateAsync:function(n){var r=t.createInflateRaw(),i=[],o=0;r.on("data",(function(e){i.push(e),o+=e.length})),r.on("end",(function(){var e=Buffer.alloc(o),t=0;e.fill(0);for(var r=0;r<i.length;r++){var s=i[r];s.copy(e,t),t+=s.length}n&&n(e)})),r.end(e)}}}},function(e,t,n){"use strict";const{randomFillSync:r}=n(34),i=new Uint32Array(256).map((e,t)=>{for(let e=0;e<8;e++)0!=(1&t)?t=t>>>1^3988292384:t>>>=1;return t>>>0}),o=(e,t)=>Math.imul(e,t)>>>0,s=(e,t)=>i[255&(e^t)]^e>>>8,a=()=>"function"==typeof r?r(Buffer.alloc(12)):a.node();a.node=()=>{const e=Buffer.alloc(12),t=e.length;for(let n=0;n<t;n++)e[n]=256*Math.random()&255;return e};const l={genSalt:a};function c(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let e=0;e<t.length;e++)this.updateKeys(t[e])}c.prototype.updateKeys=function(e){const t=this.keys;return t[0]=s(t[0],e),t[1]+=255&t[0],t[1]=o(t[1],134775813)+1,t[2]=s(t[2],t[1]>>>24),e},c.prototype.next=function(){const e=(2|this.keys[2])>>>0;return o(e,1^e)>>8&255},e.exports={decrypt:function(e,t,n){if(!e||!Buffer.isBuffer(e)||e.length<12)return Buffer.alloc(0);const r=function(e){const t=new c(e);return function(e){const n=Buffer.alloc(e.length);let r=0;for(let i of e)n[r++]=t.updateKeys(i^t.next());return n}}(n);if(r(e.slice(0,12))[11]!==t.crc>>>24)throw"ADM-ZIP: Wrong Password";return r(e.slice(12))},encrypt:function(e,t,n,r=!1){null==e&&(e=Buffer.alloc(0)),Buffer.isBuffer(e)||(e=Buffer.from(e.toString()));const i=function(e){const t=new c(e);return function(e,n,r=0){n||(n=Buffer.alloc(e.length));for(let i of e){const e=t.next();n[r++]=i^e,t.updateKeys(i)}return n}}(n),o=l.genSalt();o[11]=t.crc>>>24&255,r&&(o[10]=t.crc>>>16&255);const s=Buffer.alloc(e.length+12);return i(o,s),i(e,s,12)},_salter:function(e){Buffer.isBuffer(e)&&e.length>=12?l.genSalt=function(){return e.slice(0,12)}:l.genSalt="node"===e?a.node:a}}},function(e,t){e.exports=require("crypto")},function(e,t,n){const r=n(12),i=n(13),o=n(8);e.exports=function(e,t){var n=[],s={},a=Buffer.alloc(0),l=new i.MainHeader,c=!1;const f=Object.assign(Object.create(null),t),{noSort:u}=f;function h(){c=!0,s={},n=new Array(l.diskEntries);for(var t=l.offset,i=0;i<n.length;i++){var a=t,f=new r(e);f.header=e.slice(a,a+=o.Constants.CENHDR),f.entryName=e.slice(a,a+=f.header.fileNameLength),f.header.extraLength&&(f.extra=e.slice(a,a+=f.header.extraLength)),f.header.commentLength&&(f.comment=e.slice(a,a+f.header.commentLength)),t+=f.header.entryHeaderSize,n[i]=f,s[f.entryName]=f}}function d(){n.length>1&&!u&&n.sort((e,t)=>e.entryName.toLowerCase().localeCompare(t.entryName.toLowerCase()))}return e?function(t){var n=e.length-o.Constants.ENDHDR,r=Math.max(0,n-65535),i=r,s=e.length,c=-1,f=0;for(;n>=i;n--)if(80===e[n])if(e.readUInt32LE(n)!==o.Constants.ENDSIG)if(e.readUInt32LE(n)!==o.Constants.END64SIG){if(e.readUInt32LE(n)===o.Constants.ZIP64SIG){c=n,s=n+o.readBigUInt64LE(e,n+o.Constants.ZIP64SIZE)+o.Constants.ZIP64LEAD;break}}else i=r;else c=n,f=n,s=n+o.Constants.ENDHDR,i=n-o.Constants.END64HDR;if(!~c)throw new Error(o.Errors.INVALID_FORMAT);l.loadFromBinary(e.slice(c,s)),l.commentLength&&(a=e.slice(f+o.Constants.ENDHDR));t&&h()}(f.readEntries):c=!0,{get entries(){return c||h(),n},get comment(){return a.toString()},set comment(e){a=o.toBuffer(e),l.commentLength=a.length},getEntryCount:function(){return c?n.length:l.diskEntries},forEach:function(t){c?n.forEach(t):function(t){const n=l.diskEntries;let i=l.offset;for(let s=0;s<n;s++){let n=i;const s=new r(e);s.header=e.slice(n,n+=o.Constants.CENHDR),s.entryName=e.slice(n,n+=s.header.fileNameLength),i+=s.header.entryHeaderSize,t(s)}}(t)},getEntry:function(e){return c||h(),s[e]||null},setEntry:function(e){c||h(),n.push(e),s[e.entryName]=e,l.totalEntries=n.length},deleteEntry:function(e){c||h();var t=s[e];if(t&&t.isDirectory){var r=this;this.getEntryChildren(t).forEach((function(t){t.entryName!==e&&r.deleteEntry(t.entryName)}))}n.splice(n.indexOf(t),1),delete s[e],l.totalEntries=n.length},getEntryChildren:function(e){if(c||h(),e&&e.isDirectory){const t=[],r=e.entryName,i=r.length;return n.forEach((function(e){e.entryName.substr(0,i)===r&&t.push(e)})),t}return[]},compressToBuffer:function(){c||h(),d();const e=[],t=[];let r=0,i=0;l.size=0,l.offset=0;for(const o of n){const n=o.getCompressedData();o.header.offset=i;const s=o.header.dataHeaderToBinary(),a=o.rawEntryName.length,c=Buffer.alloc(a+o.extra.length);o.rawEntryName.copy(c,0),c.copy(o.extra,a);const f=s.length+c.length+n.length;i+=f,e.push(s),e.push(c),e.push(n);const u=o.packHeader();t.push(u),l.size+=u.length,r+=f+u.length}r+=l.mainHeaderSize,l.offset=i,i=0;const s=Buffer.alloc(r);for(const t of e)t.copy(s,i),i+=t.length;for(const e of t)e.copy(s,i),i+=e.length;const f=l.toBinary();return a&&a.copy(f,o.Constants.ENDHDR),f.copy(s,i),s},toAsyncBuffer:function(e,t,r,i){try{c||h(),d();const t=[],s=[];let f=0,u=0;l.size=0,l.offset=0;const p=function(n){if(n.length){const e=n.pop(),o=e.entryName+e.extra.toString();r&&r(o),e.getCompressedDataAsync((function(r){i&&i(o),e.header.offset=u;const a=e.header.dataHeaderToBinary(),c=Buffer.alloc(o.length,o),h=a.length+c.length+r.length;u+=h,t.push(a),t.push(c),t.push(r);const d=e.packHeader();s.push(d),l.size+=d.length,f+=h+d.length,p(n)}))}else{f+=l.mainHeaderSize,l.offset=u,u=0;const n=Buffer.alloc(f);t.forEach((function(e){e.copy(n,u),u+=e.length})),s.forEach((function(e){e.copy(n,u),u+=e.length}));const r=l.toBinary();a&&a.copy(r,o.Constants.ENDHDR),r.copy(n,u),e(n)}};p(n)}catch(e){t(e)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubpackHelper=void 0;const r=n(1),i=n(0),o=n(37),s=n(5),a=n(15),l=n(3);t.SubpackHelper=class{constructor(e,t){this.single_max_size=4194304,this.total_max_size=4194304,this._rootPath=e,this._packConfig=t,this._rootNode=new o.LTPackNode,this._rootNode.fullPath=e,this._rootNode.isNode=!1}Analyze(){let e="";switch(this._packConfig.packType){case a.EPackResolveType.AllIn:e="全入包";break;case a.EPackResolveType.AllOut:e="全出包";break;case a.EPackResolveType.AutoSearch:e="自动分析"}console.log("打包模式:",e),this._AnalyzeDir(this._rootPath,this._rootNode),this._CombieNode(this._rootNode);let t=Math.ceil(this._rootNode.size/1024),n=t/1024;console.log("资源包:",this._rootNode.fullPath,"总共",t.toFixed(0)+"kb ("+n.toFixed(2)+"mb)"),this._subpacks=[],this._remoteFiles=[],this._cacheSize=0;let s=i.join(this._rootPath,"./../");for(let e=0;e<this._packConfig.forceInPack.length;++e){let t=this._packConfig.forceInPack[e],n=i.join(s,t);console.log("强制主包",n.green);let a=new o.LTPackNode;a.isNode=!1,a.isMainPack=!0;let l=r.statSync(n);a.size=l.size,a.fullPath=n,this._subpacks.push(a),this._cacheSize+=a.size}this._SplitSubpack(this._rootNode,this._subpacks,this._remoteFiles),t=Math.ceil(this._cacheSize/1024),n=t/1024,console.log("拆分子包个数",this._subpacks.length,"总子包大小",t.toFixed(0)+"kb ("+n.toFixed(2)+"mb)")}Replace(e,t){s.LTUtils.DeleteDir(t);for(let e=0;e<this._remoteFiles.length;++e){let n=this._remoteFiles[e],r=n.fullPath.replace(this._rootPath,""),o=i.join(t,r);n.isNode?s.LTUtils.CopyFile(n.fullPath,o):s.LTUtils.CopyDir(n.fullPath,o)}s.LTUtils.DeleteDir(e);for(let t=0;t<this._subpacks.length;++t){let n=this._subpacks[t];if(n.isNode){console.log("子包检测到单文件,请注意检查".red,n.fullPath);continue}let o=n.fullPath.replace(this._rootPath,""),a=i.join(e,o);s.LTUtils.CopyDir(n.fullPath,a);let c="";switch(this._packConfig.platform){case"oppo":case"hw":c="main";break;default:c="game"}if(l.default.IsNullOrEmpty(c))continue;let f=i.join(a,"./"+c+".js");r.existsSync(f)||n.isMainPack||s.LTUtils.WriteStrTo(f,"")}let n="";switch(this._packConfig.platform){case"oppo":case"hw":n="manifest";break;case"vivo":n="src/manifest";break;default:n="game"}let o=i.join(e,"./../"+n+".json");if(!s.LTUtils.IsFileExist(o))return;let c=r.readFileSync(o,{encoding:"utf-8"}),f=JSON.parse(c),u=[],h=i.join(this._rootPath,"./../");for(let e=0;e<this._subpacks.length;++e){let t=this._subpacks[e];if(t.isNode)continue;let n=t.fullPath.replace(h,""),r=s.LTUtils.ReplaceAll(n,"\\","/"),i=s.LTUtils.ReplaceAll(r,"/","_");this._packConfig.packType==a.EPackResolveType.AutoSearch&&(this._packConfig.forceInPack.indexOf(r)>=0?console.log("强制主包",r.green):"hw"==this._packConfig.platform||u.push({name:i,root:n+"/"}))}this._packConfig.openDataContext&&(f.openDataContext="openDataContext"),"tt"==this._packConfig.platform||"gamebox4399"==this._packConfig.platform?f.subPackages=u:"oppo"==this._packConfig.platform?f.subpackages=[]:f.subpackages=u;let d=JSON.stringify(f);for(;d.indexOf("\\\\")>=0;)d=d.replace("\\\\","/");r.writeFileSync(o,d,{encoding:"utf-8"});let p=[];for(let e=0;e<this._subpacks.length;++e){let t=this._subpacks[e].fullPath.replace(h,""),n=s.LTUtils.ReplaceAll(t,"\\","/"),r=this._packConfig.packType==a.EPackResolveType.AllIn?1:2;this._packConfig.forceInPack.indexOf(n)>=0?r=1:this._packConfig.forceRemote.indexOf(n)>=0&&(r=3);let i=s.LTUtils.ReplaceAll(n,"/","_");p.push({name:i,path:n,pathType:r})}if("vivo"==this._packConfig.platform){console.log("vivo   subpack.json 设置远程包");for(let e=0;e<this._packConfig.forceRemote.length;++e){let t=this._packConfig.forceRemote[e].replace(h,""),n=s.LTUtils.ReplaceAll(t,"\\","/"),r=s.LTUtils.ReplaceAll(n,"/","_");p.push({name:r,path:n,pathType:3})}}let E=i.join(e,"./../"),g=JSON.stringify(p),m=i.join(E,"./subpack.json");if(r.writeFileSync(m,g,{encoding:"utf-8"}),console.log("输出subpack.json",m),"vivo"==this._packConfig.platform){let t=JSON.parse(r.readFileSync(o,{encoding:"utf-8"})),n=i.join(e,"./../src/game.js"),s=r.readFileSync(n,{encoding:"utf-8"});console.log("分包：",t.subpackages),s=s.replace("var subpackages = [];",`var subpackages = ${JSON.stringify(t.subpackages)};`),r.writeFileSync(n,s,{encoding:"utf-8"});let a=i.join(E,"./src/subpack.json");r.unlinkSync(a),r.renameSync(m,a)}}_SplitSubpack(e,t,n){let r=i.join(this._rootPath,"./../");for(let i=0;i<e.childs.length;++i){let o=e.childs[i];if(o.isNode)n.push(o);else{let e=o.fullPath.replace(r,"");if(e=e.replace(new RegExp("\\\\","g"),"/"),!(this._packConfig.forceInPack.indexOf(e)>=0)){this._packConfig.forceRemote.indexOf(e)>=0||this._packConfig.packType==a.EPackResolveType.AllOut?(console.log("强制远程包",e.green),n.push(o)):o.size>this.single_max_size?this._SplitSubpack(o,t,n):o.size+this._cacheSize<this.total_max_size?(t.push(o),this._cacheSize+=o.size):this._SplitSubpack(o,t,n)}}}}_CombieNode(e){for(let t=0;t<e.childs.length;++t){let n=e.childs[t];n.isNode||this._CombieNode(n),e.size+=n.size}}_AnalyzeDir(e,t){let n=r.readdirSync(e);for(let s=0;s<n.length;++s){let a=n[s],l=i.join(e,a),c=r.statSync(l),f=new o.LTPackNode;f.fullPath=l,f.parent=t,t.childs.push(f),c.isDirectory()?(f.isNode=!1,this._AnalyzeDir(l,f)):(f.isNode=!0,f.size=c.size)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LTPackNode=void 0;t.LTPackNode=class{constructor(){this.isMainPack=!1,this.childs=[],this.size=0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LTPackConfig=void 0;const r=n(15);t.LTPackConfig=class{constructor(){this.platform="",this.appid="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.forceRemote=["res/config"],this.forceInPack=["res/fgui_load"],this.maxSinglePackSize=4,this.maxTotalPackSize=8,this.packType=r.EPackResolveType.AutoSearch,this.compress=!0,this.es5=!1,this.isDebug=!1,this.openDataContext=!1}}}]);